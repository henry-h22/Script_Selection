This is essentially just a Hidden Markov Model